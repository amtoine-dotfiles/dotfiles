#!/usr/bin/env nu

$env.WM_TERM = "alacritty"
$env.WM_TERM_FLAGS = "-e"
$env.WM_TERM_SHELL = "nu"

def "connect external monitor" [] {
    let monitors = xrandr | lines | find ' connected' | split column " " name . type | select name type

    let primary = $monitors | where type == primary | get 0.name
    let external = $monitors | where type != primary | get 0.name

    nu --commands $"xrandr --output ($primary) --off --output ($external) --auto"
}

def "bspc configure" [config: record] {
    bspc config border_width $config.border_width
    bspc config window_gap $config.window_gap
    bspc config top_padding $config.padding.top
    bspc config bottom_padding $config.padding.bottom
    bspc config left_padding $config.padding.left
    bspc config right_padding $config.padding.right
}

let config = try { open ~/.config/bspwm/config.nuon } | default {}

bspc configure $config

connect external monitor

feh --randomize /usr/share/backgrounds/* --bg-fill --no-fehbg

if not (pgrep sxhkd | is-empty) {
    killall sxhkd
}
bash -c "sxhkd -c ~/.config/bspwm/sxhkdrc ~/.config/sxhkd/sxhkdrc &"
